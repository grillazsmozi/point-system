<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sorverseny Admin | Belépés</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <style>
      :where([class^="ri-"])::before { content: "\f3c2"; }
      @font-face {
      font-family: 'SF Pro Display';
      src: local('SF Pro Display');
      }
      .code-input {
      transition: all 0.3s ease;
      }
      .code-circle {
      transition: all 0.2s ease;
      }
      .code-circle.filled {
      background-color: #1D1D1F;
      border-color: #1D1D1F;
      }
      .numpad-btn {
      transition: all 0.15s ease;
      -webkit-tap-highlight-color: transparent;
      opacity: 0;
      transform: translateY(20px);
      }
      .numpad-btn.show {
      opacity: 1;
      transform: translateY(0);
      }
      .numpad-btn:active {
      transform: scale(0.97);
      }
      @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
      }
      .shake {
      animation: shake 0.4s ease-in-out;
      }
      @keyframes fadeInDown {
      from {
      opacity: 0;
      transform: translateY(-20px);
      }
      to {
      opacity: 1;
      transform: translateY(0);
      }
      }
      .fade-in-down {
      animation: fadeInDown 0.3s ease-out forwards;
      }
      .code-circle {
      opacity: 0;
      transform: scale(0.8);
      }
      .code-circle.animate {
      animation: scaleIn 0.4s ease-out forwards;
      }
      @keyframes scaleIn {
      from {
      opacity: 0;
      transform: scale(0.9);
      }
      to {
      opacity: 1;
      transform: scale(1);
      }
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#007AFF",
              secondary: "#F5F5F7",
            },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
  </head>
  <body class="min-h-screen bg-white">
    <div class="max-w-md mx-auto px-6 py-12">
      <header class="text-center mb-16 opacity-0">
        <h1
          class="text-2xl font-semibold text-[#1D1D1F] mb-2"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          Bejelentkezés az admin portálba
        </h1>
        <p
          class="text-[#86868B]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif; margin-bottom: none"
        >
          Kérem írja be a 6-számjegyű kódját.
        </p>
      </header>
      <div
        class="code-display flex justify-center space-x-4 mb-16"
        id="codeDisplay"
      >
        <div
          class="code-circle w-3 h-3 rounded-full border-2 border-[#E5E5E5]"
        ></div>
        <div
          class="code-circle w-3 h-3 rounded-full border-2 border-[#E5E5E5]"
        ></div>
        <div
          class="code-circle w-3 h-3 rounded-full border-2 border-[#E5E5E5]"
        ></div>
        <div
          class="code-circle w-3 h-3 rounded-full border-2 border-[#E5E5E5]"
        ></div>
        <div
          class="code-circle w-3 h-3 rounded-full border-2 border-[#E5E5E5]"
        ></div>
        <div
          class="code-circle w-3 h-3 rounded-full border-2 border-[#E5E5E5]"
        ></div>
      </div>
      <div class="numpad grid grid-cols-3 gap-3">
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          1
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          2
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          3
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          4
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          5
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          6
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          7
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          8
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          9
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[16px] font-normal text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          Clear
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] font-light text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          style="font-family: 'SF Pro Display', -apple-system, sans-serif"
        >
          0
        </button>
        <button
          class="numpad-btn h-[75px] rounded-full bg-[#F5F5F7] flex items-center justify-center text-[27px] text-[#1D1D1F] cursor-pointer hover:bg-[#E5E5E5] active:bg-[#D1D1D6]"
          id="backspace"
        >
          <i class="ri-delete-back-2-line text-2xl"></i>
        </button>
      </div>
    </div>
<button id="loginbtn" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  width: 60px;
  height: 60px;
  background-color: #e53935;
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  cursor: pointer;
">
  <i class="ri-phone-fill"></i>
</button>

<script src="/socket.io/socket.io.js"></script>
    <script>
      let code = "";
      const circles = document.querySelectorAll(".code-circle");
      const numpadBtns = document.querySelectorAll(".numpad-btn");
      let validCode = "";

      

      fetch('/api/settings/get/admin-login-code')
      .then(response => response.text())
        .then(text => {
          console.log('Raw response:', text);
          validCode = text
          try {
            const data = JSON.parse(text); // only if needed
            console.log('Parsed JSON:', data);
          } catch (e) {
            console.error('Invalid JSON:', e);
          }
        })
        .catch(error => {
          console.error('Fetch error:', error);
        });

      document.addEventListener("DOMContentLoaded", () => {
        // Animate header
        document.querySelector("header").classList.add("fade-in-down");
        // Animate circles
        circles.forEach((circle, index) => {
          setTimeout(() => {
            circle.classList.add("animate");
          }, index * 50);
        });
        // Animate numpad buttons
        numpadBtns.forEach((btn, index) => {
          setTimeout(
            () => {
              btn.classList.add("show");
            },
            300 + index * 30,
          );
        });
      });
      numpadBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const value = btn.textContent.trim();
          if (value === "Clear") {
            code = "";
            updateDisplay();
          } else if (btn.id === "backspace") {
            code = code.slice(0, -1);
            updateDisplay();
          } else if (code.length < 6) {
            code += value;
            updateDisplay();
            if (code.length === 6) {
              validateCode();
            }
          }
        });
      });
      function updateDisplay() {
        circles.forEach((circle, index) => {
          if (index < code.length) {
            circle.classList.add("filled");
          } else {
            circle.classList.remove("filled");
          }
        });
      }
      function validateCode() {
        if (code === validCode) {
          // Create and show loading overlay
          const overlay = document.createElement("div");
          overlay.className =
            "fixed inset-0 bg-white bg-opacity-95 flex items-center justify-center z-50 opacity-0 transition-opacity duration-300";
          overlay.innerHTML = `
      <div class="text-center">
      <div class="inline-block w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin" id="loadingSpinner"></div>
      <div class="hidden text-primary text-6xl mb-2" id="successIcon"><i class="ri-checkbox-circle-fill"></i></div>
      <p class="mt-4 text-lg text-[#1D1D1F] font-medium" style="font-family: 'SF Pro Display', -apple-system, sans-serif" id="statusText">Hitelesítés...</p>
      </div>
      `;
          document.body.appendChild(overlay);
          requestAnimationFrame(() => {
            overlay.style.opacity = "1";
          });
          // Simulate verification process
          setTimeout(() => {
            const loadingSpinner = overlay.querySelector("#loadingSpinner");
            const successIcon = overlay.querySelector("#successIcon");
            const statusText = overlay.querySelector("#statusText");
            loadingSpinner.style.display = "none";
            successIcon.style.display = "block";
            statusText.textContent = "Sikeres hitelesítés";
            setTimeout(() => {
              window.sessionStorage.setItem("admin-logged", "true")
              window.location.href = "/admin/"
            }, 2000);
          }, 2000);
        } else {
          document.querySelector(".code-display").classList.add("shake");
          setTimeout(() => {
            document.querySelector(".code-display").classList.remove("shake");
            code = "";
            updateDisplay();
          }, 300);
        }
      }
    </script>
    <script>
      const socket = io(); // Ensure Socket.IO client is connected

        if (window.sessionStorage.getItem("admin-logged") == "true") {
            window.location.href = "/admin/"; 
        }

        document.getElementById("loginbtn").addEventListener("click", () => {
        const name = prompt("Add meg a neved:");
        if (!name) return;
          socket.emit("loginRequest", { name });
        });

        socket.on("loginApproved", () => {
          // You handle login here
          window.sessionStorage.setItem("admin-logged", "true")
          window.location.reload()
          // window.location.href = “/dashboard”; // for example
        });
    </script>
  </body>
</html>
